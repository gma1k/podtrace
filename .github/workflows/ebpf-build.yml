name: eBPF Build

on:
  push:
    branches: ["**"]
    paths:
      - "bpf/**"
      - "**/*.c"
  pull_request:
    branches: ["main"]
    paths:
      - "bpf/**"
      - "**/*.c"

jobs:
  build-ebpf:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v3

      - name: Install build dependencies
        run: |
          sudo apt-get update
          sudo apt-get install -y clang llvm libbpf-dev linux-headers-$(uname -r)

      - name: Compile eBPF C programs
        run: |
          echo "Compiling eBPF programs..."
          for f in bpf/*.c; do
            base=$(basename "$f" .c)
            echo "clang -O2 -g -target bpf -c $f -o bpf/${base}.o"
            clang -O2 -g -target bpf -c "$f" -o "bpf/${base}.o"
          done

      - name: List output
        run: ls -l bpf/
